

RenderState RS_SpotLight_StencilPass
{
	CULLMODE = Back;

	BLENDENABLE						= false;

	DepthEnable						= true;
	DepthFunc						= LEQUAL;
	DepthWriteMask					= ZERO;
	StencilEnable					= true;
	FrontFaceStencilFailOp			= KEEP;
	FrontFaceStencilDepthFailOp		= REPLACE;
	FrontFaceStencilPassOp			= KEEP;
	FrontFaceStencilFunc			= Never;
	FrontFaceStencilRef				= 1;

	ColorWrite						= Zero;
};

RenderState RS_SpotLight
{
	CULLMODE = front;
	
	BLENDENABLE						= true;
	BlendSRCRGB						= ONE;
	BlendDstRGB						= ONE;
	BLENDRGBOP						= ADD;
	BlendSRCALPHA					= ONE;
	BlendDSTALPHA					= ONE;
	BLENDALPHAOP					= ADD;

	DepthEnable						= true;
	DepthFunc						= GREATER;
	DepthWriteMask					= ZERO;
	StencilEnable					= true;

	BackFaceStencilFailOp			= KEEP;
	BackFaceStencilDepthFailOp		= KEEP;
	BackFaceStencilPassOp			= KEEP;
	BackFaceStencilFunc				= EQUAL;
	BackFaceStencilRef				= 0;

	ColorWrite						= All;
};


technique deferred
{
	pass p1
	{
		SetRenderState(RS_SpotLight_StencilPass);
		SetVertexShader("./shader/dr_render_spot_light.vs");
		SetPixelShader( "");
	}

	pass p2
	{
		SetRenderState(RS_SpotLight);
		SetVertexShader("./shader/dr_render_spot_light.vs");
		SetPixelShader("./shader/dr_render_spot_light.ps");
	}
}
